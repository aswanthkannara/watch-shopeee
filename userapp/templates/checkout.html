<!--A Design by W3layouts
Author: W3layout
Author URL: http://w3layouts.com
License: Creative Commons Attribution 3.0 Unported
License URL: http://creativecommons.org/licenses/by/3.0/
-->
<!DOCTYPE HTML>
{% load static %}
<html>
<head>
<title>Watches an E-Commerce online Shopping Category Flat Bootstrap Responsive Website Template| Checkout :: w3layouts</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="keywords" content="Watches Responsive web template, Bootstrap Web Templates, Flat Web Templates, Android Compatible web template,
Smartphone Compatible web template, free webdesigns for Nokia, Samsung, LG, SonyErricsson, Motorola web design" />
<script type="application/x-javascript"> addEventListener("load", function() { setTimeout(hideURLbar, 0); }, false); function hideURLbar(){ window.scrollTo(0,1); } </script>
<link href="{% static 'assets/css/bootstrap.css' %}" rel='stylesheet' type='text/css' />
<!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
<!-- Custom Theme files -->
<link href="{% static 'assets/css/style.css' %}" rel='stylesheet' type='text/css' />
<!-- Custom Theme files -->
<!--webfont-->
<link href='//fonts.googleapis.com/css?family=PT+Sans+Narrow:400,700' rel='stylesheet' type='text/css'>
<link href='//fonts.googleapis.com/css?family=Dorsa' rel='stylesheet' type='text/css'>
<script type="text/javascript" src="{% static 'assets/js/jquery-1.11.1.min.js' %}"></script>
<!-- start menu -->
<link href="{% static 'assetscss/megamenu.css' %}" rel="stylesheet" type="text/css" media="all" />
<script type="text/javascript" src="{% static 'assets/js/megamenu.js' %}"></script>
<script>$(document).ready(function(){$(".megamenu").megamenu();});</script>
<script src="{% static 'assets/js/jquery.easydropdown.js' %}"></script>
<script src="{% static 'assets/js/simpleCart.min.js' %}"> </script>
<script src="https://www.paypal.com/sdk/js?client-id=AZd6C8-JZCtg2KeyUJ_y0FbO8iiaoTEf5MxqAmVsxOujmkehP0wlOzW8Z0N8hdG4qWiPSF9O0fO7yYiJ&currency=USD"></script> <!-- add your Client ID to process paypal(replay your client id with test)  -->



</head>
<body>
	<div class="men_banner">
   	  <div class="container">
   	  	<div class="header_top">
   	  	   <div class="header_top_left">
	  	      <div class="box_11"><a href="">
		      <h4><p>Cart: <span class=""></span> (<span id="cart" class=""></span> items)</p><img src="images/bag.png" alt=""/><div class="clearfix"> </div></h4>
		      </a></div>

	          <div class="clearfix"> </div>
	       </div>
           <div class="header_top_right">

			 <ul class="header_user_info">
			  <a class="login" href="">
				<i class="user"> </i>
				<li class="user_desc">{{request.session.username}}</li>
			  </a>
			  <a class="" href="{% url 'home:logout' %}">Logout</a>
			  <div class="clearfix"> </div>
		     </ul>
		    <!-- start search-->


		            <div class="clearfix"> </div>
			 </div>
		     <div class="clearfix"> </div>
	    </div>
   		<div class="header_bottom">
	     <div class="logo">
		    <h1><a href="index.html"><span class="m_1">W</span>atches</a></h1>
	     </div>
	    <div class="menu">

			</div>
	        <div class="clearfix"> </div>
	    </div>
	   </div>
   </div>
   <div class="account-in">
   	 <div class="container">
		  <div class="check_box">
		<div class="col-md-9 cart-items">
			 <h1>My cart</h1>
				{% if orders %}
			   {% for i in orders %}
			 <div class="cart-header">
				 <div class="close1" onclick = cartdelet({{i.id}})> </div>
				   <div class="cart-sec simpleCart_shelfItem">
						<div class="cart-item cyc">
							 <img src="{% static 'assets/images/m3.jpg' %}" class="img-responsive" alt=""/>
						</div>
					   <div class="cart-item-info">
						<h3><a href="#">{{i.product_id.name}}</a><span>${{i.tottal_price}}</span></h3>
						<ul class="qty">

							<li><p>Qty : {{i.product_count}}</p></li>
						</ul>
						<div class="delivery">


							 <div class="clearfix"></div>
				        </div>
					   </div>
					   <div class="clearfix"></div>
				    </div>
			 </div>
			{% endfor %}
			{% else %}
			<h5>No products in cart</h5>
			 {% endif %}

		 </div>
		 <div class="col-md-3 cart-total">
			 <a class="continue" href="{% url 'landing' %}">Continue to basket</a>
			 <div class="price-details">
				 <h3>Price Details</h3>
				 <span>Total</span>
				 <span class="total1">{{total_amount}}</span>
				 <span>Discount</span>
				 <span class="total1">---</span>

				 <div class="clearfix"></div>
			 </div>
			 <ul class="total_price">
			   <li class="last_price"> <h4>TOTAL</h4></li>
			   <li class="last_price"><span>{{total_amount}}</span></li>
			   <input type="hidden" value ="{{total_amount}}" name="total_amount" id="total_amount"/>
			   <div class="clearfix"> </div>
			 </ul>
			 <div class="clearfix"></div>
			 <button onclick="placeorder({{user_id}})">Place Order</button>

			</div>
			<div class="clearfix"></div>
	     </div>
			 <div id="paypal-button-container"></div>
	  </div>
   </div>
   <script>
	function cartdelet(cartid){

$.ajax({
	url : "{% url 'cartdelete' %}",
	type : "POST",
	dataType : "json",
	data : {
			'cart_id' :cartid,
			'csrfmiddlewaretoken' : $("input[name=csrfmiddlewaretoken]").val()
			},
	success : function(data) {
		console.log(data)
		location.reload()

	}
});

}
function placeorder(userid){
alert("hiiiiiiiiii")
$.ajax({
	url : "{% url 'placeorder' %}",
	type : "POST",
	dataType : "json",
	data : {
			'user_id' :userid,
			'total_amount':$('#total_amount').val(),
			'csrfmiddlewaretoken' : $("input[name=csrfmiddlewaretoken]").val()
			},
	success : function(data) {
		console.log(data)
		window.location.href = '/web/invoice/'+userid;

	}
});

}
   </script>




	 <script>

      paypal.Buttons({
        createOrder() {

          return fetch("/my-server/create-paypal-order", {

            method: "POST",

            headers: {

              "Content-Type": "application/json",

            },


            body: JSON.stringify({

              cart: [

                {

                  sku: '',

                  quantity: $('#total_amount').val(),

                },

              ],

            }),

          })

          .then((response) => response.json())

          .then((order) => order.id);

        },
        onApprove(data) {

          return fetch("/my-server/capture-paypal-order", {

            method: "POST",

            headers: {

              "Content-Type": "application/json",

            },

            body: JSON.stringify({

              orderID: data.orderID

            })

          })

          .then((response) => response.json())

          .then((orderData) => {
            console.log('Capture result', orderData, JSON.stringify(orderData, null, 2));
            const transaction = orderData.purchase_units[0].payments.captures[0];
            alert(`Transaction ${transaction.status}: ${transaction.id}\n\nSee console for all available details`);
          });

        }

      }).render('#paypal-button-container');

    </script>

</body>
</html>
